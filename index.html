<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gửi Em!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
        }
        .font-pacifico {
            font-family: 'Pacifico', cursive;
        }
        /* Hiệu ứng hộp quà bay lúc mở đầu */
        .gift-particle {
            position: absolute;
            bottom: -150px;
            opacity: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            width: 50px; /* Kích thước hộp quà bay */
            height: 50px;
        }
        /* Các keyframes cho quỹ đạo bay ngẫu nhiên */
        @keyframes floatPath1 {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120vh) translateX(15vw) rotate(360deg); opacity: 0; }
        }
        @keyframes floatPath2 {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120vh) translateX(-15vw) rotate(-360deg); opacity: 0; }
        }
        @keyframes floatPath3 {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-120vh) translateX(0) rotate(360deg); opacity: 0; }
        }

        /* Hiệu ứng hộp quà đập */
        .beating-gift {
            animation: beat 1.5s infinite ease-in-out;
            transform-origin: center;
        }
        @keyframes beat {
            0%, 100% { transform: scale(1); }
            10%, 30% { transform: scale(0.95); }
            20%, 40%, 60% { transform: scale(1.1); }
            50%, 70% { transform: scale(1.05); }
        }
        /* Hiệu ứng confetti */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--color);
            opacity: 1;
            animation: fall 3s linear forwards;
        }
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        /* Hiệu ứng hộp quà rung lắc */
        .secret-gift:hover {
            animation: shake 0.5s;
            animation-iteration-count: infinite;
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body class="bg-rose-50">

    <!-- Màn hình hộp quà bay lúc đầu -->
    <div id="intro-particles" class="fixed inset-0 z-50 bg-rose-100 transition-opacity duration-1000 overflow-hidden"></div>

    <!-- Màn hình chờ vào trang chính -->
    <div id="intro-screen" class="fixed inset-0 z-40 bg-rose-100 flex flex-col justify-center items-center text-center p-4 opacity-0 transition-opacity duration-1000 pointer-events-none">
        <h1 class="font-pacifico text-5xl md:text-7xl text-pink-500 mb-8">Chúc Mừng Sinh Nhật!</h1>
        <button id="enter-button" class="bg-pink-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-110 transition-transform duration-300">
            Mở quà nè!
        </button>
    </div>

    <!-- Nội dung chính của trang web -->
    <main id="main-content" class="hidden opacity-0 transition-opacity duration-1000 overflow-y-auto h-screen">
        <div class="container mx-auto p-4 md:p-8 text-center">
            
            <header class="my-8">
                <h2 class="font-pacifico text-4xl md:text-6xl text-pink-500">Chúc mừng sinh nhật tình yêu của anh!</h2>
                <p class="text-lg text-gray-600 mt-4">Hôm nay là một ngày thật đặc biệt, vì đó là ngày em đến với thế giới này.</p>
            </header>

            <!-- Hộp điều ước -->
            <section class="my-16">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Gửi một điều ước cho tuổi mới!</h3>
                <!-- HƯỚNG DẪN: URL Formspree đã được dán vào đây -->
                <form id="wish-form" action="https://formspree.io/f/xjkejryl" method="POST" class="max-w-md mx-auto">
                    <input id="wish-input" type="text" name="wish" placeholder="Em hãy gõ điều ước vào đây..." class="w-full p-3 border-2 border-pink-300 rounded-lg focus:outline-none focus:border-pink-500 mb-4">
                    <button id="wish-button" type="submit" class="bg-violet-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform hover:scale-110 transition-transform duration-300">Gửi điều ước bay xa</button>
                </form>
            </section>

            <!-- Hộp quà bí mật -->
            <section class="my-16">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">Anh có một món quà bí mật cho em nè!</h3>
                <div id="gift-box" class="inline-block cursor-pointer secret-gift">
                    <svg class="w-32 h-32" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <g>
                            <!-- Box Lid -->
                            <rect x="10" y="25" width="80" height="15" rx="5" fill="#fbcfe8" stroke="#f472b6" stroke-width="2"/>
                            <!-- Box Body -->
                            <rect x="10" y="40" width="80" height="50" rx="5" fill="#fce7f3" stroke="#f472b6" stroke-width="2"/>
                            <!-- Vertical Ribbon -->
                            <rect x="44" y="25" width="12" height="65" fill="#f9a8d4"/>
                            <!-- Horizontal Ribbon -->
                            <rect x="10" y="57" width="80" height="12" fill="#f9a8d4"/>
                            <!-- Bow Left -->
                            <path d="M40,25 C20,25 20,0 45,10 Z" fill="#f472b6"/>
                            <!-- Bow Right -->
                            <path d="M60,25 C80,25 80,0 55,10 Z" fill="#f472b6"/>
                            <!-- Bow Center -->
                            <circle cx="50" cy="18" r="7" fill="#db2777"/>
                        </g>
                    </svg>
                </div>
                <p id="secret-message" class="text-xl text-pink-600 mt-4 opacity-0 transition-opacity duration-500 font-semibold">"Món quà lớn nhất chính là có em trong đời!"</p>
            </section>

            <!-- Lời nhắn từ trái tim -->
            <section class="my-16 bg-rose-100 p-6 md:p-8 rounded-2xl shadow-inner">
                <h3 class="font-pacifico text-3xl text-pink-500 mb-4">Lời nhắn từ trái tim anh...</h3>
                <p class="text-lg text-gray-700 leading-relaxed max-w-2xl mx-auto">
                    "Gửi em, cô gái bé nhỏ của anh, <br>
                    Chúc mừng sinh nhật lần thứ [Số tuổi] của em! Mỗi ngày trôi qua, anh lại càng cảm thấy mình may mắn hơn khi có em ở bên. Em là ánh nắng sưởi ấm trái tim anh, là nụ cười làm bừng sáng cả một ngày. Anh mong tuổi mới của em sẽ tràn ngập niềm vui, hạnh phúc và những điều ngọt ngào nhất. Hãy luôn là cô gái rạng rỡ và đáng yêu như em vẫn luôn là nhé. Yêu em rất nhiều!"
                </p>
            </section>

        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const introParticles = document.getElementById('intro-particles');
            const introScreen = document.getElementById('intro-screen');
            const enterButton = document.getElementById('enter-button');
            const mainContent = document.getElementById('main-content');
            
            const wishForm = document.getElementById('wish-form');
            const wishInput = document.getElementById('wish-input');
            const wishButton = document.getElementById('wish-button');

            const giftBox = document.getElementById('gift-box');
            const secretMessage = document.getElementById('secret-message');

            const giftSVG = `
                <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <g>
                        <rect x="10" y="25" width="80" height="15" rx="5" fill="#fbcfe8" stroke="#f472b6" stroke-width="2"/>
                        <rect x="10" y="40" width="80" height="50" rx="5" fill="#fce7f3" stroke="#f472b6" stroke-width="2"/>
                        <rect x="44" y="25" width="12" height="65" fill="#f9a8d4"/>
                        <rect x="10" y="57" width="80" height="12" fill="#f9a8d4"/>
                        <path d="M40,25 C20,25 20,0 45,10 Z" fill="#f472b6"/>
                        <path d="M60,25 C80,25 80,0 55,10 Z" fill="#f472b6"/>
                        <circle cx="50" cy="18" r="7" fill="#db2777"/>
                    </g>
                </svg>
            `;

            // 1. Hiệu ứng hộp quà bay lúc mở đầu
            function createFloatingGift() {
                const particle = document.createElement('div');
                particle.classList.add('gift-particle');
                particle.innerHTML = giftSVG; // Thay thế emoji bằng SVG
                
                const animationPaths = ['floatPath1', 'floatPath2', 'floatPath3'];
                const randomPath = animationPaths[Math.floor(Math.random() * animationPaths.length)];
                
                particle.style.animationName = randomPath;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.animationDuration = `${Math.random() * 5 + 7}s`;
                
                const scale = Math.random() * 0.8 + 0.7;
                particle.style.transform = `scale(${scale})`;
                
                introParticles.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 12000);
            }
            const introInterval = setInterval(createFloatingGift, 200); // Tăng khoảng cách để đỡ rối mắt

            // 2. Chuyển từ màn hình intro sang màn hình chính
            setTimeout(() => {
                clearInterval(introInterval);
                introParticles.style.opacity = '0';
                introScreen.style.opacity = '1';
                introScreen.style.pointerEvents = 'auto';
                setTimeout(() => introParticles.remove(), 1000);
            }, 5000); 

            enterButton.addEventListener('click', () => {
                introScreen.style.opacity = '0';
                mainContent.classList.remove('hidden');
                document.body.style.overflow = 'auto';
                setTimeout(() => {
                    introScreen.remove();
                    mainContent.style.opacity = '1';
                }, 1000);
            });

            // 3. Chức năng gửi điều ước và bắn pháo hoa
            wishForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Ngăn chặn việc tải lại trang

                if (wishInput.value.trim() === '') {
                    alert("Em chưa gõ điều ước kìa!");
                    return;
                }

                const formData = new FormData(wishForm);
                const wishButtonOriginalText = wishButton.innerHTML;
                wishButton.innerHTML = 'Đang gửi...'; // Phản hồi cho người dùng
                wishButton.disabled = true;

                fetch(wishForm.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                }).then(response => {
                    if (response.ok) {
                        triggerConfetti();
                        alert("Điều ước của em đã được gửi đến các vì sao (và cả anh nữa)! ✨");
                        wishInput.value = '';
                    } else {
                        response.json().then(data => {
                            if (Object.hasOwn(data, 'errors')) {
                                alert(data["errors"].map(error => error["message"]).join(", "));
                            } else {
                                alert("Oops! Có lỗi xảy ra, không gửi được điều ước.");
                            }
                        })
                    }
                }).catch(error => {
                    alert("Oops! Có lỗi xảy ra, không gửi được điều ước.");
                }).finally(() => {
                    wishButton.innerHTML = wishButtonOriginalText; // Khôi phục lại nút
                    wishButton.disabled = false;
                });
            });

            function triggerConfetti() {
                const colors = ['#f9a8d4', '#f472b6', '#ec4899', '#fef08a', '#a78bfa', '#ffffff'];
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.classList.add('confetti');
                    confetti.style.left = `${Math.random() * 100}vw`;
                    confetti.style.top = `${Math.random() * -50}vh`;
                    confetti.style.setProperty('--color', colors[Math.floor(Math.random() * colors.length)]);
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }
            }

            // 4. Chức năng hộp quà bí mật
            giftBox.addEventListener('click', () => {
                secretMessage.style.opacity = '1';
                giftBox.style.animation = 'none';
                giftBox.style.cursor = 'default';
            });
        });
    </script>
</body>
</html>